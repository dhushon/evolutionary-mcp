openapi: 3.0.3
info:
  title: Evolutionary MCP API
  description: |
    Evolutionary Memory Service API.
  version: 1.0.0
servers:
  - url: http://localhost:8080/api/v1
    description: Local development (HTTP)
  - url: https://localhost:8443/api/v1
    description: Local development (HTTPS)
components:
  securitySchemes:
    openIdConnect:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: "{oktaIssuer}/v1/authorize"
          tokenUrl: "{oktaIssuer}/v1/token"
          scopes:
            openid: "openid scope"
            profile: "profile scope"
            email: "email scope"
            evolve:read: "read access"
            evolve:write: "write access"
  schemas:
    HealthStatus:
      type: object
      properties:
        status:
          type: string
          example: "ok"
        timestamp:
          type: string
          format: date-time
        service:
          type: string
          example: "evolutionary-mcp"
        version:
          type: string
          example: "1.0.0"
    ProblemDetails:
      type: object
      properties:
        type:
          type: string
        title:
          type: string
        status:
          type: integer
        detail:
          type: string
        instance:
          type: string
          nullable: true
    Workflow:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string

tags:
  - name: health
    description: Service health and readiness checks
  - name: status
    description: Service status
  - name: workflows
    description: Workflow operations

paths:
  /health:
    get:
      tags: [health]
      summary: Health check
      description: Returns overall service health status
      operationId: getHealth
      security: [] # No security for this endpoint
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
  /status:
    get:
      tags: [status]
      summary: Status check
      description: Returns service status for authenticated users
      operationId: getStatus
      security:
        - openIdConnect: [openid, profile, email]
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
  /workflows:
    get:
      tags: [workflows]
      summary: List workflows
      description: Returns a list of workflows
      operationId: listWorkflows
      security:
        - openIdConnect: [evolve:read]
      responses:
        '200':
          description: A list of workflows
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Workflow'
    put:
      tags: [workflows]
      summary: Create or update a workflow
      description: Creates or updates a workflow.
      operationId: putWorkflow
      security:
        - openIdConnect: [evolve:read, evolve:write]
      responses:
        '200':
          description: Workflow updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
    patch:
      tags: [workflows]
      summary: Partially update a workflow
      description: Partially updates a workflow.
      operationId: patchWorkflow
      security:
        - openIdConnect: [evolve:read, evolve:write]
      responses:
        '200':
          description: Workflow patched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
    delete:
      tags: [workflows]
      summary: Delete a workflow
      description: Deletes a workflow.
      operationId: deleteWorkflow
      security:
        - openIdConnect: [evolve:read, evolve:write]
      responses:
        '204':
          description: Workflow deleted
